<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Análise de Qualidade</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; color: #1f2937; }
        .chart-container { position: relative; margin: auto; height: 400px; width: 100%; }
        .header-syngenta { background-color: #00493f; color: white; padding: 2rem; border-radius: 1rem; margin-bottom: 2rem; }
        .card { background-color: white; border-radius: 1rem; padding: 1.5rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">
    <div class="max-w-7xl mx-auto">
        <header class="header-syngenta text-center">
            <h1 class="text-3xl sm:text-4xl font-bold tracking-tight">Dashboard de Análise de Qualidade</h1>
            <p class="mt-2 text-lg text-gray-200">Versão Final - Dados de 06/10/2025</p>
        </header>

        <div class="card mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-center text-gray-800">Ranking de Prioridade de Processamento por Campo</h2>
            <div class="chart-container" style="height:500px;"><canvas id="rankingChart"></canvas></div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <div class="card">
                <h2 class="text-2xl font-semibold mb-4 text-center text-gray-800">Composição por Germinação</h2>
                 <div class="chart-container" style="height:500px;"><canvas id="germinationChart"></canvas></div>
            </div>
            <div class="card">
                <h2 class="text-2xl font-semibold mb-4 text-center text-gray-800">Composição por Vigor</h2>
                 <div class="chart-container" style="height:500px;"><canvas id="vigorChart"></canvas></div>
            </div>
        </div>

        <div class="card mb-8">
             <h2 class="text-2xl font-semibold mb-6 text-center text-gray-800">Tabela Resumo da Análise</h2>
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-gray-600 rounded-lg overflow-hidden">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-200">
                        <tr>
                            <th scope="col" class="px-6 py-3">Ranking</th><th scope="col" class="px-6 py-3">ID do Campo</th><th scope="col" class="px-6 py-3">Total de Sacos</th>
                            <th scope="col" class="px-6 py-3">Score Germinação</th><th scope="col" class="px-6 py-3">Score Vigor</th><th scope="col" class="px-6 py-3 font-bold">Score Final</th>
                            <th scope="col" class="px-6 py-3">Recomendação</th>
                        </tr>
                    </thead>
                    <tbody id="rankingTableBody"></tbody>
                </table>
            </div>
        </div>

        <div class="card mb-8">
            <h2 class="text-2xl font-semibold mb-6 text-center text-gray-800">Análise Agregada por Peneira</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div>
                    <h3 class="text-xl font-semibold mb-4 text-center text-gray-700">Volume por Peneira (Germinação)</h3>
                    <div class="chart-container"><canvas id="sieveGenChart"></canvas></div>
                </div>
                <div>
                    <h3 class="text-xl font-semibold mb-4 text-center text-gray-700">Volume por Peneira (Vigor)</h3>
                    <div class="chart-container"><canvas id="sieveVigorChart"></canvas></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DADOS EXTRAÍDOS EXCLUSIVAMENTE DO TEXTO FORNECIDO NA ÚLTIMA SOLICITAÇÃO
        const rawData = [
            { id: "BRAE4186", sacs: 948, batch: "R5", classGen: "Y", classSvt: "G" }, { id: "BRAE4186", sacs: 2600, batch: "R4", classGen: "G", classSvt: "G+" }, { id: "BRAE4186", sacs: 1527, batch: "R3", classGen: "Y", classSvt: "G" }, { id: "BRAE4186", sacs: 249, batch: "R2", classGen: "G", classSvt: "Y" }, { id: "BRAE4186", sacs: 1120, batch: "C4", classGen: "G+", classSvt: "G+" }, { id: "BRAE4186", sacs: 535, batch: "C3", classGen: "G", classSvt: "G+" }, { id: "BRAE4186", sacs: 133, batch: "C2", classGen: "G+", classSvt: "G" },
            { id: "BRAE4187", sacs: 1035, batch: "R5", classGen: "G+", classSvt: "G" }, { id: "BRAE4187", sacs: 2723, batch: "R4", classGen: "Y", classSvt: null }, { id: "BRAE4187", sacs: 2065, batch: "R3", classGen: "G", classSvt: "G" }, { id: "BRAE4187", sacs: 529, batch: "R2", classGen: "Y", classSvt: "Y" }, { id: "BRAE4187", sacs: 251, batch: "C5", classGen: "G", classSvt: "G" }, { id: "BRAE4187", sacs: 1177, batch: "C4", classGen: "G", classSvt: "G+" }, { id: "BRAE4187", sacs: 784, batch: "C3", classGen: "G+", classSvt: "G+" }, { id: "BRAE4187", sacs: 236, batch: "C2", classGen: "G+", classSvt: "G" },
            { id: "BRAE4205", sacs: 618, batch: "R5", classGen: "G+", classSvt: "G+" }, { id: "BRAE4205", sacs: 2328, batch: "R4", classGen: "G+", classSvt: "G+" }, { id: "BRAE4205", sacs: 2320, batch: "R3", classGen: "G+", classSvt: "G+" }, { id: "BRAE4205", sacs: 739, batch: "R2", classGen: "G+", classSvt: "G+" }, { id: "BRAE4205", sacs: 181, batch: "C5", classGen: "G+", classSvt: "G+" }, { id: "BRAE4205", sacs: 1055, batch: "C4", classGen: "G+", classSvt: "G+" }, { id: "BRAE4205", sacs: 830, batch: "C3", classGen: "G+", classSvt: "G+" }, { id: "BRAE4205", sacs: 331, batch: "C2", classGen: "G+", classSvt: "G+" },
            { id: "BRAE4206", sacs: 452, batch: "R5", classGen: "G+", classSvt: "G+" }, { id: "BRAE4206", sacs: 1997, batch: "R4", classGen: "G+", classSvt: "G+" }, { id: "BRAE4206", sacs: 2286, batch: "R3", classGen: "G+", classSvt: "G+" }, { id: "BRAE4206", sacs: 956, batch: "R2", classGen: "G", classSvt: "G" }, { id: "BRAE4206", sacs: 65, batch: "C5", classGen: "G", classSvt: null }, { id: "BRAE4206", sacs: 662, batch: "C4", classGen: "G+", classSvt: "G+" }, { id: "BRAE4206", sacs: 548, batch: "C3", classGen: "G+", classSvt: "G+" }, { id: "BRAE4206", sacs: 305, batch: "C2", classGen: "G+", classSvt: "G+" },
            { id: "BRAE4208", sacs: 672, batch: "R5", classGen: "G", classSvt: "G" }, { id: "BRAE4208", sacs: 2340, batch: "R4", classGen: "G+", classSvt: "Y" }, { id: "BRAE4208", sacs: 1986, batch: "R3", classGen: "Y", classSvt: "Y" }, { id: "BRAE4208", sacs: 481, batch: "R2", classGen: "G+", classSvt: "R" }, { id: "BRAE4208", sacs: 176, batch: "C5", classGen: "Y", classSvt: "G" }, { id: "BRAE4208", sacs: 1032, batch: "C4", classGen: "G+", classSvt: "G" }, { id: "BRAE4208", sacs: 815, batch: "C3", classGen: "G", classSvt: "Y" }, { id: "BRAE4208", sacs: 287, batch: "C2", classGen: "G", classSvt: "Y" },
            { id: "BRAK1861", sacs: 21, batch: "R5", classGen: "Y", classSvt: "Y" }, { id: "BRAK1861", sacs: 702, batch: "R4", classGen: "G+", classSvt: "G" }, { id: "BRAK1861", sacs: 1487, batch: "R3", classGen: "G+", classSvt: "G" }, { id: "BRAK1861", sacs: 1378, batch: "R2", classGen: "G", classSvt: "G" }, { id: "BRAK1861", sacs: 59, batch: "C4", classGen: "G", classSvt: "G" }, { id: "BRAK1861", sacs: 194, batch: "C3", classGen: "G+", classSvt: "G" }, { id: "BRAK1861", sacs: 328, batch: "C2", classGen: "G+", classSvt: "G" },
            { id: "BRAK1941", sacs: 1234, batch: "R5", classGen: "G+", classSvt: "G" }, { id: "BRAK1941", sacs: 3336, batch: "R4", classGen: "G+", classSvt: "G+" }, { id: "BRAK1941", sacs: 5461, batch: "R3", classGen: "G+", classSvt: "G" }, { id: "BRAK1941", sacs: 3018, batch: "R2", classGen: "G", classSvt: "G+" }, { id: "BRAK1941", sacs: 3336, batch: "C4", classGen: "G+", classSvt: "G+" }, { id: "BRAK1941", sacs: 5461, batch: "C3", classGen: "G+", classSvt: "G+" }, { id: "BRAK1941", sacs: 3018, batch: "C2", classGen: "G+", classSvt: "G+" },
            { id: "BRAK1943", sacs: 812, batch: "R5", classGen: "G+", classSvt: "G" }, { id: "BRAK1943", sacs: 3154, batch: "R4", classGen: "G+", classSvt: "G+" }, { id: "BRAK1943", sacs: 3473, batch: "R3", classGen: "G+", classSvt: "G+" }, { id: "BRAK1943", sacs: 1707, batch: "R2", classGen: "G+", classSvt: "G+" }, { id: "BRAK1943", sacs: 177, batch: "C5", classGen: "G", classSvt: null }, { id: "BRAK1943", sacs: 1042, batch: "C4", classGen: "G+", classSvt: "G+" }, { id: "BRAK1943", sacs: 1507, batch: "C3", classGen: "G+", classSvt: "G+" }, { id: "BRAK1943", sacs: 919, batch: "C2", classGen: "G+", classSvt: "G+" },
            { id: "BRAK1944", sacs: 548, batch: "R5", classGen: "G", classSvt: "G" }, { id: "BRAK1944", sacs: 3227, batch: "R4", classGen: "G+", classSvt: "G+" }, { id: "BRAK1944", sacs: 6379, batch: "R3", classGen: "G+", classSvt: "G" }, { id: "BRAK1944", sacs: 5601, batch: "R2", classGen: "G", classSvt: "G" }, { id: "BRAK1944", sacs: 744, batch: "C4", classGen: "G+", classSvt: "G+" }, { id: "BRAK1944", sacs: 1272, batch: "C3", classGen: "G+", classSvt: "G+" }, { id: "BRAK1944", sacs: 1434, batch: "C2", classGen: "G+", classSvt: "G" },
            { id: "BRAK1963B", sacs: 393, batch: "R5", classGen: "Y", classSvt: "Y" }, { id: "BRAK1963B", sacs: 1590, batch: "R4", classGen: "G+", classSvt: "G" }, { id: "BRAK1963B", sacs: 2382, batch: "R3", classGen: "G+", classSvt: "G" }, { id: "BRAK1963B", sacs: 1649, batch: "R2", classGen: "G+", classSvt: "G" }, { id: "BRAK1963B", sacs: 557, batch: "C4", classGen: "G+", classSvt: null }, { id: "BRAK1963B", sacs: 666, batch: "C3", classGen: "G+", classSvt: null }, { id: "BRAK1963B", sacs: 425, batch: "C2", classGen: "G+", classSvt: "G" }
        ];

        const qualityToScore = { 'G+': 4, 'G': 3, 'Y': 2, 'R': 1 };
        const scoreToQuality = (score) => { if (score >= 3.5) return 'G+'; if (score >= 2.8) return 'G'; if (score >= 1.9) return 'Y'; return 'R'; };
        const fields = [...new Set(rawData.map(item => item.id))];
        const analysisData = fields.map(id => {
            const fieldData = rawData.filter(item => item.id === id);
            const totalSacs = fieldData.reduce((sum, item) => sum + item.sacs, 0);
            const breakdownGen_bags = { 'G+': 0, 'G': 0, 'Y': 0, 'R': 0 };
            const breakdownSvt_bags = { 'G+': 0, 'G': 0, 'Y': 0, 'R': 0 };
            let weightedScoreGen = 0, weightedScoreSvt = 0;
            let svtSacsTotal = 0;
            fieldData.forEach(item => {
                if(item.classGen) breakdownGen_bags[item.classGen] += item.sacs;
                if(item.classSvt) {
                    breakdownSvt_bags[item.classSvt] += item.sacs;
                    svtSacsTotal += item.sacs;
                }
                if(item.classGen) weightedScoreGen += (qualityToScore[item.classGen] || 0) * item.sacs;
                if(item.classSvt) weightedScoreSvt += (qualityToScore[item.classSvt] || 0) * item.sacs;
            });
            const scoreGen = totalSacs > 0 ? weightedScoreGen / totalSacs : 0;
            const scoreSvt = svtSacsTotal > 0 ? weightedScoreSvt / svtSacsTotal : 0;
            return {
                id: id, sacs: totalSacs, scoreGen: scoreGen, scoreSvt: scoreSvt, finalScore: (scoreGen + scoreSvt) / 2,
                breakdownGen_bags, breakdownSvt_bags,
                breakdownGen_perc: { 'G+': (breakdownGen_bags['G+']/totalSacs)*100, 'G': (breakdownGen_bags['G']/totalSacs)*100, 'Y': (breakdownGen_bags['Y']/totalSacs)*100, 'R': (breakdownGen_bags['R']/totalSacs)*100 },
                breakdownSvt_perc: { 'G+': (breakdownSvt_bags['G+']/totalSacs)*100, 'G': (breakdownSvt_bags['G']/totalSacs)*100, 'Y': (breakdownSvt_bags['Y']/totalSacs)*100, 'R': (breakdownSvt_bags['R']/totalSacs)*100 }
            };
        });
        analysisData.sort((a, b) => b.finalScore - a.finalScore);

        const qualityColors = { 'G+': { bg: 'rgba(16, 124, 65, 0.9)' }, 'G':  { bg: 'rgba(151, 215, 0, 0.9)' }, 'Y':  { bg: 'rgba(253, 192, 0, 0.9)' }, 'R':  { bg: 'rgba(228, 30, 38, 0.9)' } };
        const getScoreColor = (score) => { if (score >= 3.5) return qualityColors['G+'].bg; if (score >= 2.8) return qualityColors['G'].bg; if (score >= 1.9) return qualityColors['Y'].bg; return qualityColors['R'].bg; };
        
        Chart.defaults.color = '#374151'; Chart.defaults.borderColor = '#d1d5db'; Chart.defaults.font.family = "'Inter', 'sans-serif'"; Chart.defaults.plugins.tooltip.backgroundColor = '#1f2937';

        new Chart(document.getElementById('rankingChart').getContext('2d'), { type: 'bar', data: { labels: analysisData.map(d => d.id), datasets: [{ label: 'Score Final Combinado', data: analysisData.map(d => d.finalScore.toFixed(2)), backgroundColor: analysisData.map(d => getScoreColor(d.finalScore)), borderWidth: 1.5, borderRadius: 5 }] }, options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', scales: { x: { beginAtZero: true, max: 4.5, title: { display: true, text: 'Score (0 a 4)' } } }, plugins: { legend: { display: false }, tooltip: { callbacks: { label: (c) => `Score: ${c.raw} | Sacos: ${analysisData[c.dataIndex].sacs.toLocaleString('pt-BR')}` } } } } });
        
        function createCompositionChart(canvasId, bagsKey, percKey) {
            new Chart(document.getElementById(canvasId).getContext('2d'), { type: 'bar', data: { labels: analysisData.map(d => d.id), datasets: Object.keys(qualityColors).map(q => ({ label: q, data: analysisData.map(d => d[percKey][q]), backgroundColor: qualityColors[q].bg })) }, options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', scales: { x: { stacked: true, max: 100, ticks: { callback: (v) => v + "%" } }, y: { stacked: true } }, plugins: { legend: { position: 'bottom' }, tooltip: { callbacks: { label: (c) => { const bags = analysisData[c.dataIndex][bagsKey][c.dataset.label]; return ` ${c.dataset.label}: ${c.raw.toFixed(1)}% (${bags.toLocaleString('pt-BR')} sacos)`; } } } } } });
        }
        createCompositionChart('germinationChart', 'breakdownGen_bags', 'breakdownGen_perc');
        createCompositionChart('vigorChart', 'breakdownSvt_bags', 'breakdownSvt_perc');

        function createSieveAnalysisChart(canvasId, classKey) {
            const sieves = [...new Set(rawData.map(d => d.batch))].sort((a,b) => a.localeCompare(b, undefined, {numeric: true}));
            const sieveData = {};
            sieves.forEach(sieve => { sieveData[sieve] = { 'G+': 0, 'G': 0, 'Y': 0, 'R': 0 }; });
            rawData.forEach(d => { if(d[classKey]) sieveData[d.batch][d[classKey]] += d.sacs; });
            new Chart(document.getElementById(canvasId).getContext('2d'), { type: 'bar', data: { labels: sieves, datasets: Object.keys(qualityColors).map(q => ({ label: q, data: sieves.map(s => sieveData[s][q]), backgroundColor: qualityColors[q].bg })) }, options: { responsive: true, maintainAspectRatio: false, scales: { x: { stacked: true }, y: { stacked: true, title: { display: true, text: 'Nº de Sacos' } } }, plugins: { legend: { position: 'bottom' }, tooltip: { callbacks: { label: (c) => ` ${c.dataset.label}: ${c.raw.toLocaleString('pt-BR')} sacos` } } } } });
        }
        createSieveAnalysisChart('sieveGenChart', 'classGen');
        createSieveAnalysisChart('sieveVigorChart', 'classSvt');

        const tableBody = document.getElementById('rankingTableBody');
        analysisData.forEach((data, index) => {
            const qualityClass = scoreToQuality(data.finalScore); const color = qualityColors[qualityClass].bg;
            const text = { 'G+': 'Prioridade Máxima', 'G': 'Prioridade Alta', 'Y': 'Processar com Cautela', 'R': 'Risco Elevado / Reavaliar' }[qualityClass];
            const textColor = (qualityClass === 'G+' || qualityClass === 'Y') ? '#1f2937' : 'white';
            tableBody.innerHTML += `<tr class="${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'} hover:bg-gray-200">
                <td class="px-6 py-4 font-bold text-lg text-gray-900">${index + 1}</td><td class="px-6 py-4 font-medium text-gray-900">${data.id}</td>
                <td class="px-6 py-4">${data.sacs.toLocaleString('pt-BR')}</td><td class="px-6 py-4">${data.scoreGen.toFixed(2)}</td><td class="px-6 py-4">${data.scoreSvt.toFixed(2)}</td>
                <td class="px-6 py-4 text-lg font-bold text-gray-900">${data.finalScore.toFixed(2)}</td>
                <td class="px-6 py-4"><span class="px-3 py-1 text-xs font-semibold rounded-full" style="background-color:${color}; color:${textColor};">${text}</span></td>
            </tr>`;
        });
    </script>
</body>
</html>